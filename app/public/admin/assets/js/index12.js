import{g as R,u as j,I,v as L,x as M,y as V,a as g}from"./element-plus.js";import{a as $,u as z}from"./vue-router.js";import{H as F,F as H}from"./@element-plus.js";import{l as K,a as O}from"./field.js";import{h as P}from"./model.js";import{r as l,n as U,ab as A,c as G,o as y,O as t,T as J,L as r,a3 as Q,K as W,u as h}from"./@vue.js";import"./dayjs.js";import"./ace-builds.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./index.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";/* empty css     */const X={class:"bg-fff radius-6 pd-20"},he={__name:"index",setup(Y){const w=$(),C=z(),s=l({mid:w.query.mid}),i=l(""),u=l(""),k=l([]),d=l([]),m=l(0),p=l(1),_=l(!0),c=async()=>{try{const e=await K(s.value.mid,p.value);if(e.code===200){const o=e.data;d.value=[...o.list],i.value=o.model.model,u.value=o.model.tableName,m.value=o.count,_.value=!1}}catch(e){console.error(e)}},x=e=>{k.value=e},E=e=>{p.value=Number(e),sessionStorage.setItem("cur",Number(e)),c()},N=e=>{const{id:o,ename:a}=e;C.push({name:"field-edit",query:{fid:o,mid:s.value.mid,table:a,model:i.value}})},B=async e=>{let{id:o}=e;try{(await P(s.value.mid)).data.count===0?(await O(o)).code===200&&(g({message:"删除成功 ^_^",type:"success"}),c()):g({message:"当前模型正在使用，字段不能删除 ^_^",type:"warning"})}catch(a){console.error(a)}};return U(()=>{c()}),(e,o)=>{const a=R,f=A("router-link"),v=j,n=L,T=M,q=V,D=I;return y(),G("div",X,[t(v,{type:"flex",justify:"end"},{default:r(()=>[t(f,{to:{name:"field-add",query:{mid:s.value.mid,table:u.value,model:i.value}}},{default:r(()=>[t(a,{type:"primary",round:""},{default:r(()=>o[0]||(o[0]=[Q("新增")])),_:1})]),_:1},8,["to"])]),_:1}),J((y(),W(T,{ref:"multipleTable",data:d.value,"tooltip-effect":"dark",style:{width:"100%"},"row-key":"id",onSelectionChange:x},{default:r(()=>[t(n,{type:"selection",width:"55"}),t(n,{prop:"id",label:"编号"}),t(n,{prop:"cname",label:"中文名称"}),t(n,{prop:"ename",label:"字段名称"}),t(n,{prop:"orderBy",label:"排序"}),t(n,{fixed:"right",label:"操作",width:"150"},{default:r(b=>[t(a,{icon:h(F),circle:"",onClick:S=>N(b.row)},null,8,["icon","onClick"]),t(a,{icon:h(H),circle:"",onClick:S=>B(b.row)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[D,_.value]]),t(v,{type:"flex",class:"mt-20",justify:"space-between"},{default:r(()=>[t(q,{background:"",layout:"prev, pager, next",onCurrentChange:E,"page-size":10,total:m.value,"hide-on-single-page":""},null,8,["total"])]),_:1})])}}};export{he as default};
