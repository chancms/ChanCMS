import{r as M,s as T,g as I,N as L,B as O,C as S,V as j,q as F,a as p}from"./element-plus.js";import{a as H,u as z}from"./vue-router.js";import{f as G}from"./category.js";import{d as J,g as K,u as P}from"./gather.js";import{_ as $,c as Q,a as W,t as X}from"./index.js";import{r as m,V as w,n as Y,c as Z,o as ee,U as l,K as s,a as t,a2 as r,O as V}from"./@vue.js";import"./dayjs.js";import"./ace-builds.js";import"./@element-plus.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";import"./@fingerprintjs.js";import"./tslib.js";/* empty css     */const te={class:"mb-20 bg-fff pd-20"},ae={class:"flex w-full"},le={class:"flex w-full"},se={class:"f-15"},re=["innerHTML"],oe={__name:"edit",setup(ne){const x=H(),k=z(),c=m(null),o=w({id:x.params.id,taskName:"",targetUrl:"",parseData:JSON.stringify({title:{path:"data.tip"},content:{path:"data.news",isArray:!0,wrap:"p"}},null,2),status:"1",cid:1}),f=m([]),U={checkStrictly:!0},g=m([]),_=m({}),d=w({});async function E(){try{let a=await G();if(a.code===200){let e=a.data,n=Q(o.cid,e);f.value=n;let u=W(X(e));g.value=[...u]}}catch(a){console.log(a)}}function C(a){a.length&&a[a.length-1]!=-1&&(o.cid=a[a.length-1])}async function N(){try{let a=await J(o.id);a.code===200&&Object.assign(o,a.data)}catch(a){console.error(a)}}async function h(){try{let{targetUrl:a,parseData:e}=o;if(!a){p({message:"请输入接口地址",type:"warning"});return}let n=await K({targetUrl:a,parseData:e});n.code===200?(_.value=n.source||{},Object.assign(d,n.data),p({message:"恭喜你，获取数据成功^_^",type:"success"})):p({message:n.msg||"获取数据失败",type:"error"})}catch(a){console.error(a),p({message:"请求异常，请稍后重试",type:"error"})}}async function D(){try{let a=await P(o);a.code==200?(p({message:"更新成功^_^",type:"success"}),k.go(-1)):p({message:a.msg,type:"error"})}catch(a){console.log(a)}}function q(){c.value.validate(a=>{if(a)D();else return!1})}return Y(async()=>{await N(),await E()}),(a,e)=>{const n=T,u=M,b=I,B=L,y=S,R=O,v=j,A=F;return ee(),Z("div",te,[l(A,{ref_key:"formRef",ref:c,model:o,"label-width":"84px"},{default:s(()=>[l(u,{label:"任务名称",prop:"taskName",rules:[{required:!0,message:"请输入任务名称",trigger:"blur"}]},{default:s(()=>[l(n,{modelValue:o.taskName,"onUpdate:modelValue":e[0]||(e[0]=i=>o.taskName=i),placeholder:"例：文章-chancms"},null,8,["modelValue"])]),_:1}),l(u,{label:"接口地址",prop:"targetUrl",rules:[{required:!0,message:"请输入匹配网址",trigger:"blur"}]},{default:s(()=>[t("div",ae,[l(n,{class:"flex-1",modelValue:o.targetUrl,"onUpdate:modelValue":e[1]||(e[1]=i=>o.targetUrl=i)},null,8,["modelValue"])])]),_:1}),l(u,{label:"数据配置",prop:"parseData",rules:[{required:!0,message:"请输入内容字段",trigger:"blur"}]},{default:s(()=>[t("div",le,[l(n,{class:"flex-1",type:"textarea",rows:13,modelValue:o.parseData,"onUpdate:modelValue":e[2]||(e[2]=i=>o.parseData=i),placeholder:"json获取数据配置\n            "},null,8,["modelValue"]),l(b,{class:"ml-5",type:"primary",onClick:h},{default:s(()=>[...e[5]||(e[5]=[r("测试",-1)])]),_:1})]),e[6]||(e[6]=t("div",{class:"w-full"},[t("h3",{class:"mt-10"},"参数说明："),t("p",null,"注意：title和content字段必须要配置，用于文章的标题和内容。"),t("p",{class:"lh-20 bg-f2f2f2 w-full pd-10 radius-5"},[r(" {"),t("br"),t("strong",null,'"title"'),r(": {"),t("br"),t("strong",null,'"path"'),r(': "data.xxx", // 指定从数据源中提取标题字段的路径（必填）'),t("br"),t("strong",null,'"prefix"'),r(': "前缀内容", // 可选，为提取出的标题添加前缀'),t("br"),t("strong",null,'"suffix"'),r(': "后缀内容", // 可选，为提取出的标题添加后缀'),t("br"),t("strong",null,' "default"'),r(': "默认值" // 可选，当指定路径无数据时使用的默认值'),t("br"),t("strong",null,'"isArray"'),r(": true, // 可选，数据是数组，则必须设置为 true"),t("br"),t("strong",null,'"wrap"'),r(': "p" // 可选，当 isArray 为 true 时，指定的 HTML 标签（如 p、div 等）包裹'),t("br"),r(" },"),t("br"),r(" }")])],-1))]),_:1}),l(u,{label:"保存栏目",prop:"cid",rules:[{required:!0,message:"请输入保存栏目",trigger:"blur"}]},{default:s(()=>[l(B,{props:U,"show-all-levels":!1,modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=i=>f.value=i),options:g.value,onChange:C},null,8,["modelValue","options"])]),_:1}),l(u,{label:"发布状态",prop:"status",rules:[{required:!0,message:"请选择发布状态",trigger:"blur"}]},{default:s(()=>[l(R,{modelValue:o.status,"onUpdate:modelValue":e[4]||(e[4]=i=>o.status=i),class:"ml-4"},{default:s(()=>[l(y,{value:"1",size:"large"},{default:s(()=>[...e[7]||(e[7]=[r("草稿",-1)])]),_:1}),l(y,{value:"2",size:"large"},{default:s(()=>[...e[8]||(e[8]=[r("发布",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"采集结果"},{default:s(()=>[e[11]||(e[11]=t("h3",{class:"mb-10"},"原始数据 ",-1)),l(v,{class:"w-full",shadow:"never"},{default:s(()=>[r(V(_.value),1)]),_:1}),e[12]||(e[12]=t("h3",{class:"mt-10 mb-10"},"结果数据：",-1)),l(v,{class:"w-full",shadow:"never"},{header:s(()=>[t("p",se,[e[9]||(e[9]=t("span",{class:"c-999"},"标题：",-1)),r(V(d==null?void 0:d.title),1)])]),default:s(()=>[e[10]||(e[10]=t("p",{class:"f-15"},[t("span",{class:"c-999"},"内容：")],-1)),t("div",{class:"f-15 article",innerHTML:d==null?void 0:d.content},null,8,re)]),_:1})]),_:1}),l(u,null,{default:s(()=>[l(b,{type:"primary",onClick:q},{default:s(()=>[...e[13]||(e[13]=[r("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])}}},Be=$(oe,[["__scopeId","data-v-28054991"]]);export{Be as default};
