import{r as F,s as I,g as M,N as T,B as j,C as L,V as O,q as S,a as m}from"./element-plus.js";import{a as z,u as G}from"./vue-router.js";import{f as H}from"./category.js";import{d as P,g as A,u as J}from"./gather.js";import{_ as K,c as Q,a as W,t as X}from"./index.js";import{r as c,V,n as Y,c as Z,o as b,U as a,K as s,J as $,G as ee,a as o,a2 as i,O as te}from"./@vue.js";import"./dayjs.js";import"./ace-builds.js";import"./@element-plus.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";import"./@fingerprintjs.js";import"./tslib.js";/* empty css     */const ae={class:"mb-20 bg-fff pd-20"},le={class:"flex w-full"},se={class:"flex w-full"},oe={class:"f-15"},re=["innerHTML"],ne={__name:"edit",setup(ue){const v=z(),x=G(),f=c(null),l=V({id:v.params.id,taskName:"",targetUrl:"",parseData:"",status:"1",cid:1}),p=c([]),w={checkStrictly:!0},g=c([]),d=V({title:"",article:""});async function k(){try{let t=await H();if(t.code===200){let e=t.data,u=Q(l.cid,e);p.value=u;let r=W(X(e));g.value=[...r]}}catch(t){console.log(t)}}function U(t){t.length&&t[t.length-1]!=-1&&(l.cid=t[t.length-1])}async function C(){try{let t=await P(l.id);t.code===200&&Object.assign(l,t.data)}catch(t){console.error(t)}}async function E(){try{let{targetUrl:t,parseData:e}=l,u=await A({targetUrl:t,parseData:e});u.code==200&&(Object.assign(d,u.data),m({message:"恭喜你，获取数据成功^_^",type:"success"}))}catch(t){console.log(t)}}async function N(){try{let t=await J(l);t.code==200?(m({message:"更新成功^_^",type:"success"}),x.go(-1)):m({message:t.msg,type:"error"})}catch(t){console.log(t)}}function B(){f.value.validate(t=>{if(t)N();else return!1})}return Y(async()=>{await C(),await k()}),(t,e)=>{const u=I,r=F,_=M,D=T,y=L,q=j,R=O,h=S;return b(),Z("div",ae,[a(h,{ref_key:"formRef",ref:f,model:l,"label-width":"84px"},{default:s(()=>[a(r,{label:"任务名称",prop:"taskName",rules:[{required:!0,message:"请输入任务名称",trigger:"blur"}]},{default:s(()=>[a(u,{modelValue:l.taskName,"onUpdate:modelValue":e[0]||(e[0]=n=>l.taskName=n),placeholder:"例：前端库-chat问答"},null,8,["modelValue"])]),_:1}),a(r,{label:"接口地址",prop:"targetUrl",rules:[{required:!0,message:"请输入匹配网址",trigger:"blur"}]},{default:s(()=>[o("div",le,[a(u,{class:"flex-1",modelValue:l.targetUrl,"onUpdate:modelValue":e[1]||(e[1]=n=>l.targetUrl=n)},null,8,["modelValue"])])]),_:1}),a(r,{label:"数据配置",prop:"parseData",rules:[{required:!0,message:"请输入内容字段",trigger:"blur"}]},{default:s(()=>[o("div",se,[a(u,{class:"flex-1",type:"textarea",rows:13,modelValue:l.parseData,"onUpdate:modelValue":e[2]||(e[2]=n=>l.parseData=n),placeholder:"json获取数据配置\n            "},null,8,["modelValue"]),a(_,{class:"ml-5",type:"primary",onClick:E},{default:s(()=>[...e[5]||(e[5]=[i("测试",-1)])]),_:1})]),e[6]||(e[6]=o("div",null,[o("h3",null,"参数说明："),o("p",null,'{"字段名": {'),o("p",null,'"path": "data.xxx",// 要提取的字段路径'),o("p",null,'"prefix": "前缀内容", // 可选'),o("p",null,'"suffix": "后缀内容",// 可选'),o("p",null,'"default": "默认值" // 可选'),o("p",null," }}")],-1))]),_:1}),a(r,{label:"保存栏目",prop:"cid",rules:[{required:!0,message:"请输入保存栏目",trigger:"blur"}]},{default:s(()=>[a(D,{props:w,"show-all-levels":!1,modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=n=>p.value=n),options:g.value,onChange:U},null,8,["modelValue","options"])]),_:1}),a(r,{label:"发布状态",prop:"status",rules:[{required:!0,message:"请选择发布状态",trigger:"blur"}]},{default:s(()=>[a(q,{modelValue:l.status,"onUpdate:modelValue":e[4]||(e[4]=n=>l.status=n),class:"ml-4"},{default:s(()=>[a(y,{value:"1",size:"large"},{default:s(()=>[...e[7]||(e[7]=[i("草稿",-1)])]),_:1}),a(y,{value:"2",size:"large"},{default:s(()=>[...e[8]||(e[8]=[i("发布",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),d.title?(b(),$(r,{key:0,label:"采集结果"},{default:s(()=>[a(R,{class:"w-full",shadow:"never"},{header:s(()=>[o("p",oe,[e[9]||(e[9]=o("span",{class:"c-999"},"标题：",-1)),i(te(d.title),1)])]),default:s(()=>[e[10]||(e[10]=o("p",{class:"f-15"},[o("span",{class:"c-999"},"内容：")],-1)),o("div",{class:"f-15 article",innerHTML:d.content},null,8,re)]),_:1})]),_:1})):ee("",!0),a(r,null,{default:s(()=>[a(_,{type:"primary",onClick:B},{default:s(()=>[...e[11]||(e[11]=[i("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])}}},he=K(ne,[["__scopeId","data-v-b1e05a7a"]]);export{he as default};
