import{r as B,s as M,g as R,N as h,B as L,C as H,V as I,q as S,a as i}from"./element-plus.js";import{u as j}from"./vue-router.js";import{f as z}from"./category.js";import{g as F,c as O}from"./gather.js";import{_ as G,a as K,t as P}from"./index.js";import{r as m,V,n as $,c as J,o as Q,U as r,K as a,a as t,a2 as s,O as w}from"./@vue.js";import"./dayjs.js";import"./ace-builds.js";import"./@element-plus.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";import"./@fingerprintjs.js";import"./tslib.js";/* empty css     */const W={class:"mb-20 bg-fff pd-20"},X={class:"flex w-full"},Y={class:"flex w-full"},Z={class:"f-15"},ee=["innerHTML"],te={__name:"add",setup(le){const x=j(),f=m(null),o=V({taskName:"",targetUrl:"",parseData:'{\n    "title": {\n        "path": "data.tip"\n    },\n    "content": {\n        "path": "data.news",\n        "isArray": true,\n        "wrap": "p"\n    }\n}',status:1,cid:1}),c=m([]),k={checkStrictly:!0},g=m([]),_=m({}),p=V({});async function U(){try{let l=await z();if(l.code===200){let e=K(P(l.data));g.value=[...e]}}catch(l){console.log(l)}}function E(l){l.length&&l[l.length-1]!=-1&&(o.cid=l[l.length-1])}async function C(){try{let{targetUrl:l,parseData:e}=o;if(!l){i({message:"请输入接口地址",type:"warning"});return}let u=await F({targetUrl:l,parseData:e});u.code===200?(_.value=u.source||{},Object.assign(p,u.data),i({message:"恭喜你，获取数据成功^_^",type:"success"})):i({message:u.msg||"获取数据失败",type:"error"})}catch(l){console.error(l),i({message:"请求异常，请稍后重试",type:"error"})}}async function N(){try{let l=await O(o);l.code==200?(i({message:"新增成功^_^",type:"success"}),x.go(-1)):i({message:l.msg,type:"error"})}catch(l){console.log(l)}}function q(){f.value.validate(l=>{if(l)N();else return!1})}return $(()=>{U()}),(l,e)=>{const u=M,d=B,b=R,D=h,y=H,T=L,v=I,A=S;return Q(),J("div",W,[r(A,{ref_key:"formRef",ref:f,model:o,"label-width":"84px"},{default:a(()=>[r(d,{label:"任务名称",prop:"taskName",rules:[{required:!0,message:"请输入任务名称",trigger:"blur"}]},{default:a(()=>[r(u,{modelValue:o.taskName,"onUpdate:modelValue":e[0]||(e[0]=n=>o.taskName=n),placeholder:"例：文章-chancms"},null,8,["modelValue"])]),_:1}),r(d,{label:"接口地址",prop:"targetUrl",rules:[{required:!0,message:"请输入匹配网址",trigger:"blur"}]},{default:a(()=>[t("div",X,[r(u,{class:"flex-1",modelValue:o.targetUrl,"onUpdate:modelValue":e[1]||(e[1]=n=>o.targetUrl=n)},null,8,["modelValue"])])]),_:1}),r(d,{label:"数据配置",prop:"parseData",rules:[{required:!0,message:"请输入内容字段",trigger:"blur"}]},{default:a(()=>[t("div",Y,[r(u,{class:"flex-1",type:"textarea",rows:13,modelValue:o.parseData,"onUpdate:modelValue":e[2]||(e[2]=n=>o.parseData=n),placeholder:"json获取数据配置"},null,8,["modelValue"]),r(b,{class:"ml-5",type:"primary",onClick:C},{default:a(()=>[...e[5]||(e[5]=[s(" 测试 ",-1)])]),_:1})]),e[6]||(e[6]=t("div",{class:"w-full"},[t("h3",{class:"mt-10"},"参数说明："),t("p",null,"注意：title和content字段必须要配置，用于文章的标题和内容。"),t("p",{class:"lh-20 bg-f2f2f2 w-full pd-10 radius-5"},[s(" {"),t("br"),t("strong",null,'"title"'),s(": {"),t("br"),t("strong",null,'"path"'),s(': "data.xxx", // 指定从数据源中提取标题字段的路径（必填）'),t("br"),t("strong",null,'"prefix"'),s(': "前缀内容", // 可选，为提取出的标题添加前缀'),t("br"),t("strong",null,'"suffix"'),s(': "后缀内容", // 可选，为提取出的标题添加后缀'),t("br"),t("strong",null,' "default"'),s(': "默认值" // 可选，当指定路径无数据时使用的默认值'),t("br"),t("strong",null,'"isArray"'),s(": true, // 可选，数据是数组，则必须设置为 true"),t("br"),t("strong",null,'"wrap"'),s(': "p" // 可选，当 isArray 为 true 时，指定的 HTML 标签（如 p、div 等）包裹'),t("br"),s(" },"),t("br"),s(" }")])],-1))]),_:1}),r(d,{label:"保存栏目",prop:"cid",rules:[{required:!0,message:"请输入保存栏目",trigger:"blur"}]},{default:a(()=>[r(D,{props:k,"show-all-levels":!1,modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=n=>c.value=n),options:g.value,onChange:E},null,8,["modelValue","options"])]),_:1}),r(d,{label:"发布状态",prop:"status",rules:[{required:!0,message:"请选择发布状态",trigger:"blur"}]},{default:a(()=>[r(T,{modelValue:o.status,"onUpdate:modelValue":e[4]||(e[4]=n=>o.status=n),class:"ml-4"},{default:a(()=>[r(y,{value:"1",size:"large"},{default:a(()=>[...e[7]||(e[7]=[s("草稿",-1)])]),_:1}),r(y,{value:"2",size:"large"},{default:a(()=>[...e[8]||(e[8]=[s("发布",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(d,{label:"采集结果"},{default:a(()=>[e[11]||(e[11]=t("h3",{class:"mb-10"},"原始数据 ",-1)),r(v,{class:"w-full",shadow:"never"},{default:a(()=>[s(w(_.value),1)]),_:1}),e[12]||(e[12]=t("h3",{class:"mt-10 mb-10"},"结果数据：",-1)),r(v,{class:"w-full",shadow:"never"},{header:a(()=>[t("p",Z,[e[9]||(e[9]=t("span",{class:"c-999"},"标题：",-1)),s(w(p==null?void 0:p.title),1)])]),default:a(()=>[e[10]||(e[10]=t("p",{class:"f-15"},[t("span",{class:"c-999"},"内容：")],-1)),t("div",{class:"f-15 article",innerHTML:p==null?void 0:p.content},null,8,ee)]),_:1})]),_:1}),r(d,null,{default:a(()=>[r(b,{type:"primary",onClick:q},{default:a(()=>[...e[13]||(e[13]=[s("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])}}},Ce=G(te,[["__scopeId","data-v-63a59038"]]);export{Ce as default};
