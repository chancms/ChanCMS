import{g as U,u as V,v as j,x as F,y as H,a as _}from"./element-plus.js";import{u as J}from"./vue-router.js";import{H as q,F as z,J as G}from"./@element-plus.js";import{l as D,b as K,a as L}from"./collect.js";import{c as O}from"./article.js";import{f as Q}from"./index.js";import{r as p,V as W,n as X,ai as Y,aq as Z,c as tt,o as E,U as a,K as n,a2 as m,O as v,R as h,u as b,J as et}from"./@vue.js";import"./dayjs.js";import"./ace-builds.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";import"./@fingerprintjs.js";import"./tslib.js";/* empty css     */const at={class:"bg-fff radius-6 pd-20"},Et={__name:"index",setup(ot){const A=J(),S=p(null),w=p([]),B=p([]),C=p(0),k=p(1),l=p(0),i=W({cid:0,title:"",shortTitle:"",tagId:"",attr:[],source:"",author:"",description:"",img:"",createdAt:new Date,updatedAt:new Date,content:"欢迎使用ChanCMS系统",status:"0",pv:1,link:""}),x=async()=>{try{const e=await D(k.value);e.code===200&&(w.value=[...e.data.list],C.value=e.data.count)}catch(e){console.log(e)}},$=e=>{k.value=e,D()},R=e=>{B.value=e},T=async e=>{try{const{pages:t,titleTag:o,articleTag:d,parseData:c,charset:s,cid:g,status:y}=e,u=t.split(","),r=await L({taskUrl:u[l.value],titleTag:o,articleTag:d,parseData:c,charset:s});if(r.code===200){const{title:f,article:P}=r.data;i.title=f,i.content=P,i.cid=g,i.status=y===1?1:0,I(i)}}catch(t){console.log(t)}},I=async e=>{try{const t={...i};t.attr=t.attr.toString(),t.tagId=t.tagId.toString(),!t.description&&t.content&&(t.description=Q(t.content).substr(0,255));const o=await O({defaultParams:t,fieldParams:{}});o.code===200?(_({message:"第".concat(l.value+1,"条数据完成^_^"),type:"success"}),setTimeout(()=>{const{pages:d}=e,c=d.split(",");l.value<=c.length-1&&(T(e),l.value=l.value+1)},3e3)):_({message:o.msg||"第".concat(l.value+1,"条数据失败^_^"),type:"error"})}catch(t){console.log(t)}},M=e=>{const t=e.id;A.push({name:"collect-edit",params:{id:t}})},N=async e=>{const t=e.id;try{const o=await K(t);o.code===200?(_({message:"删除成功 ^_^",type:"success"}),x()):_({message:o.msg,type:"error"})}catch(o){console.log(o)}};return X(()=>{x()}),(e,t)=>{const o=U,d=Y("router-link"),c=V,s=j,g=F,y=H,u=Z("permission-disabled");return E(),tt("div",at,[a(c,{type:"flex",justify:"end"},{default:n(()=>[a(d,{to:"/collect/add"},{default:n(()=>[a(o,{type:"primary",round:""},{default:n(()=>[...t[0]||(t[0]=[m("新增",-1)])]),_:1})]),_:1})]),_:1}),a(g,{ref_key:"multipleTable",ref:S,data:w.value,"tooltip-effect":"dark","row-key":"id",onSelectionChange:R},{default:n(()=>[a(s,{type:"selection"}),a(s,{prop:"id",width:"60",label:"编号"}),a(s,{prop:"taskName",label:"任务名称"}),a(s,{prop:"category",label:"所属栏目"}),a(s,{prop:"charset",label:"编码"},{default:n(r=>[m(v(r.row.charset===1?"UTF-8":"GB2312"),1)]),_:1}),a(s,{prop:"status",label:"状态"},{default:n(r=>[m(v(r.row.status===1?"草稿":"发布"),1)]),_:1}),a(s,{prop:"updatedAt",label:"发布时间"},{default:n(r=>[m(v(r.row.updatedAt),1)]),_:1}),a(s,{fixed:"right",width:"222",label:"操作"},{default:n(r=>[h(a(o,{icon:b(q),circle:"",onClick:f=>M(r.row)},null,8,["icon","onClick"]),[[u,["editor","admin","super"]]]),h(a(o,{icon:b(z),circle:"",onClick:f=>N(r.row)},null,8,["icon","onClick"]),[[u,["editor","admin","super"]]]),h((E(),et(o,{type:"primary",round:"",icon:b(G),onClick:f=>T(r.row)},{default:n(()=>[...t[1]||(t[1]=[m("执行",-1)])]),_:1},8,["icon","onClick"])),[[u,["editor","admin","super"]]])]),_:1})]),_:1},8,["data"]),a(c,{type:"flex",class:"mt-20 align-c",justify:"center"},{default:n(()=>[a(y,{background:"",layout:"prev, pager, next",onCurrentChange:$,"page-size":10,total:C.value,"hide-on-single-page":""},null,8,["total"])]),_:1})])}}};export{Et as default};
