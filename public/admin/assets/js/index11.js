import{g as N,u as P,v as R,x as F,y as H,a as f}from"./element-plus.js";import{u as L}from"./vue-router.js";import{H as U,F as V,J as z}from"./@element-plus.js";import{l as x,b as G,a as J}from"./collect.js";import{c as O}from"./article.js";import{f as Q}from"./index.js";import{r as p,W,n as q,aj as K,c as X,o as Y,O as a,L as l,a3 as m,Q as y,u as h}from"./@vue.js";import"./dayjs.js";import"./ace-builds.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";/* empty css     */const Z={class:"bg-fff radius-6 pd-20"},wt={__name:"index",setup(tt){const T=L(),E=p(null),v=p([]),A=p([]),b=p(0),C=p(1),n=p(0),c=W({cid:0,title:"",shortTitle:"",tagId:"",attr:[],source:"",author:"",description:"",img:"",createdAt:new Date,updatedAt:new Date,content:"欢迎使用ChanCMS系统",status:"0",pv:1,link:""}),w=async()=>{try{const e=await x(C.value);e.code===200&&(v.value=[...e.data.list],b.value=e.data.count)}catch(e){console.log(e)}},S=e=>{C.value=e,x()},D=e=>{A.value=e},k=async e=>{try{const{pages:t,titleTag:o,articleTag:u,parseData:i,charset:s,cid:_,status:g}=e,r=t.split(","),d=await J({taskUrl:r[n.value],titleTag:o,articleTag:u,parseData:i,charset:s});if(d.code===200){const{title:I,article:M}=d.data;c.title=I,c.content=M,c.cid=_,c.status=g===1?1:0,$(c)}}catch(t){console.log(t)}},$=async e=>{try{const t={...c};t.attr=t.attr.toString(),t.tagId=t.tagId.toString(),!t.description&&t.content&&(t.description=Q(t.content).substr(0,255));const o=await O({defaultParams:t,fieldParams:{}});o.code===200?(f({message:"第".concat(n.value+1,"条数据完成^_^"),type:"success"}),setTimeout(()=>{const{pages:u}=e,i=u.split(",");n.value<=i.length-1&&(k(e),n.value=n.value+1)},3e3)):f({message:o.msg||"第".concat(n.value+1,"条数据失败^_^"),type:"error"})}catch(t){console.log(t)}},B=e=>{const t=e.id;T.push({name:"collect-edit",params:{id:t}})},j=async e=>{const t=e.id;try{const o=await G(t);o.code===200?(f({message:"删除成功 ^_^",type:"success"}),w()):f({message:o.msg,type:"error"})}catch(o){console.log(o)}};return q(()=>{w()}),(e,t)=>{const o=N,u=K("router-link"),i=P,s=R,_=F,g=H;return Y(),X("div",Z,[a(i,{type:"flex",justify:"end"},{default:l(()=>[a(u,{to:"/collect/add"},{default:l(()=>[a(o,{type:"primary",round:""},{default:l(()=>t[0]||(t[0]=[m("新增",-1)])),_:1,__:[0]})]),_:1})]),_:1}),a(_,{ref_key:"multipleTable",ref:E,data:v.value,"tooltip-effect":"dark","row-key":"id",onSelectionChange:D},{default:l(()=>[a(s,{type:"selection"}),a(s,{prop:"id",width:"60",label:"编号"}),a(s,{prop:"taskName",label:"任务名称"}),a(s,{prop:"category",label:"所属栏目"}),a(s,{prop:"charset",label:"编码"},{default:l(r=>[m(y(r.row.charset===1?"UTF-8":"GB2312"),1)]),_:1}),a(s,{prop:"status",label:"状态"},{default:l(r=>[m(y(r.row.status===1?"草稿":"发布"),1)]),_:1}),a(s,{prop:"updatedAt",label:"发布时间"},{default:l(r=>[m(y(r.row.updatedAt),1)]),_:1}),a(s,{fixed:"right",width:"222",label:"操作"},{default:l(r=>[a(o,{icon:h(U),circle:"",onClick:d=>B(r.row)},null,8,["icon","onClick"]),a(o,{icon:h(V),circle:"",onClick:d=>j(r.row)},null,8,["icon","onClick"]),a(o,{type:"primary",round:"",icon:h(z),onClick:d=>k(r.row)},{default:l(()=>t[1]||(t[1]=[m("执行",-1)])),_:2,__:[1]},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"]),a(i,{type:"flex",class:"mt-20 align-c",justify:"center"},{default:l(()=>[a(g,{background:"",layout:"prev, pager, next",onCurrentChange:S,"page-size":10,total:b.value,"hide-on-single-page":""},null,8,["total"])]),_:1})])}}};export{wt as default};
