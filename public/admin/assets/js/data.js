import{a as k,b as re,y as ie,D as ue,S as ce,g as de,Y as pe,A as ve}from"./element-plus.js";import{r as c,n as _e,e as $,aj as v,c as n,o as a,a as o,H as y,O as r,I as C,ac as D,J as A,Q as d,L as i,P as me,a3 as _,K as F}from"./@vue.js";import{b as ge}from"./codefile.js";import{d as fe}from"./article.js";import{_ as he}from"./index.js";import"./dayjs.js";import"./ace-builds.js";import"./@element-plus.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./js-cookie.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./vue-router.js";import"./axios.js";import"./nprogress.js";/* empty css     */const ke={class:"oss-manager"},ye={class:"header"},Ce={class:"folder-path"},Fe=["onClick"],we={key:0,class:"image-grid"},ze=["onClick"],xe={class:"folder-content"},Me={class:"folder-name"},Be=["onClick"],$e=["src","alt"],De={class:"image-info"},Ie={class:"image-name"},Pe={class:"image-size"},Ue={class:"image-actions"},Ve=["onClick"],Ee={key:1,class:"no-images"},be={key:2,class:"pagination"},Le=["src"],Te={class:"dialog-actions"},Se={class:"image-size"},Oe={class:"image-size"},Re={class:"image-size"},je={class:"dialog-footer"},Ne={key:3,class:"upload-progress"},Ae={class:"upload-info"},Qe={class:"upload-name"},Ke={class:"upload-status"},Ge={key:0},He={key:1},Je={key:2,class:"upload-success"},Ye={key:3,class:"upload-error"},qe={__name:"data",setup(We){const m=c(""),w=c([]),z=c(""),T=c(""),x=c(1),I=c(12),P=c(!1),g=c(null),M=c(!1),h=c([]),Q=c(null),B=c([]);let K=0;_e(()=>{U()});const U=async()=>{try{const t=await ge({path:m.value});if(console.log("文件树响应:",t),t.code===200){let e=t.data;e.forEach(l=>{l.type==="file"&&(l.url="/".concat(l.relativePath.replace(/\\/g,"/")))}),w.value=e}else k.error("加载文件树失败: ".concat(t.msg))}catch(t){console.error("加载文件树失败:",t),k.error("加载文件树失败，请检查网络连接")}},V=t=>{const e=t.replace(/\\/g,"/");m.value=e,x.value=1,U()},G=t=>{g.value=t,P.value=!0},H=async t=>{console.log("deleteFile",t.url);let e=t.url;ve.confirm('确定要删除文件 "'.concat(t.name,'" 吗？此操作不可恢复。'),"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await fe(e)).code==200&&k.success("删除成功"),U()}).catch(()=>{})},J=t=>t.size>100*1024*1024?(k.error("文件大小不能超过100MB"),!1):!0,Y=t=>{const e=h.value.findIndex(l=>l.uid===t.uid);e!==-1&&h.value.splice(e,1)},q=()=>{if(h.value.length===0){k.warning("请选择要上传的文件");return}M.value=!1,h.value.forEach(t=>{B.value.push({id:K++,file:t.raw,progress:0,status:"waiting"})}),E()},E=()=>{const t=B.value.find(l=>l.status==="waiting");if(!t)return;t.status="uploading";const e=setInterval(()=>{t.progress+=Math.floor(Math.random()*10)+5,t.progress>=100&&(clearInterval(e),t.progress=100,setTimeout(()=>{t.status="success";const l={id:Date.now(),name:t.file.name,relativePath:m.value?"".concat(m.value,"/").concat(t.file.name):t.file.name,path:"",url:URL.createObjectURL(t.file),size:t.file.size,type:S(t.file.name),createdAt:new Date().toISOString().split("T")[0]};w.value.push(l),E()},500))},200)},W=t=>{t.status="waiting",t.progress=0,t.error=null,E()},S=t=>{const e=t.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif","webp"].includes(e)?"image":["mp4","mov","avi","mkv"].includes(e)?"video":["pdf","doc","docx","xls","xlsx","ppt","pptx"].includes(e)?"document":["zip","rar","7z","tar"].includes(e)?"archive":"other"},O=t=>{if(t===0)return"0 Bytes";const e=1024,l=["Bytes","KB","MB","GB"],u=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,u)).toFixed(2))+" "+l[u]},R=$(()=>{if(!m.value)return[];const e=m.value.replace(/\\/g,"/").split("/").filter(p=>p);let l="";const u=[];for(let p=0;p<e.length;p++)l=l?"".concat(l,"/").concat(e[p]):e[p],u.push({name:e[p],path:l});return u.splice(0,2),u}),j=$(()=>w.value.filter(t=>{if(t.type!=="file")return!1;const e=T.value?S(t.name)===T.value:!0,l=z.value?t.name.toLowerCase().includes(z.value.toLowerCase()):!0;return e&&l})),b=$(()=>w.value.filter(t=>t.type!=="directory"?!1:z.value?t.name.toLowerCase().includes(z.value.toLowerCase()):!0)),X=$(()=>{const t=(x.value-1)*I.value,e=t+I.value;return j.value.slice(t,e)});return(t,e)=>{const l=v("Folder"),u=re,p=v("Delete"),Z=v("FolderOpened"),ee=ie,N=ue,te=v("UploadFilled"),se=ce,L=de,oe=v("Document"),ae=v("CircleCheckFilled"),le=v("CircleCloseFilled"),ne=pe;return a(),n("div",ke,[o("div",ye,[o("div",Ce,[o("span",{onClick:e[0]||(e[0]=s=>V("")),class:"path-item"},"根目录"),(a(!0),n(C,null,D(R.value,(s,f)=>(a(),n(C,{key:f},[e[5]||(e[5]=o("span",{class:"path-separator"},">",-1)),o("span",{onClick:Xe=>V(s.path),class:A(["path-item",{current:f===R.value.length-1}])},d(s.name),11,Fe)],64))),128))])]),b.value.length>0?(a(),n("div",we,[(a(!0),n(C,null,D(b.value,s=>(a(),n("div",{key:s.id,class:"image-item",onClick:f=>V(s.relativePath)},[o("div",xe,[r(u,{class:"folder-icon"},{default:i(()=>[r(l)]),_:1}),o("div",Me,d(s.name),1)])],8,ze))),128)),(a(!0),n(C,null,D(X.value,s=>(a(),n("div",{key:s.id,class:"image-item",onClick:f=>G(s)},[o("img",{src:s.url,class:"image-preview",alt:s.name},null,8,$e),o("div",De,[o("div",Ie,d(s.name),1),o("div",Pe,d(O(s.size)),1)]),o("div",Ue,[o("div",{class:"action-btn delete",onClick:me(f=>H(s),["stop"])},[r(u,null,{default:i(()=>[r(p)]),_:1})],8,Ve)])],8,Be))),128))])):(a(),n("div",Ee,[r(u,{size:50},{default:i(()=>[r(Z)]),_:1}),e[6]||(e[6]=o("p",null,"暂无文件",-1))])),b.value.length>0?(a(),n("div",be,[r(ee,{background:"",layout:"prev, pager, next",total:j.value.length,"page-size":I.value,"current-page":x.value,"onUpdate:currentPage":e[1]||(e[1]=s=>x.value=s)},null,8,["total","page-size","current-page"])])):y("",!0),r(N,{modelValue:P.value,"onUpdate:modelValue":e[2]||(e[2]=s=>P.value=s),class:"image-dialog",width:"80%",top:"5vh"},{default:i(()=>[o("img",{src:g.value?g.value.url:"",alt:"预览"},null,8,Le),o("div",Te,[o("div",Se,[e[7]||(e[7]=o("span",{class:"file-info"},"尺 寸：",-1)),_(d(O(g.value.size)),1)]),o("div",Oe,[e[8]||(e[8]=o("span",{class:"file-info"},"文件名：",-1)),_(d(g.value.name),1)]),o("div",Re,[e[9]||(e[9]=o("span",{class:"file-info"},"网 址：",-1)),_(d(g.value.url),1)])])]),_:1},8,["modelValue"]),r(N,{modelValue:M.value,"onUpdate:modelValue":e[4]||(e[4]=s=>M.value=s),title:"上传文件",width:"600px"},{footer:i(()=>[o("div",je,[r(L,{onClick:e[3]||(e[3]=s=>M.value=!1)},{default:i(()=>e[12]||(e[12]=[_("取消",-1)])),_:1,__:[12]}),r(L,{type:"primary",onClick:q},{default:i(()=>e[13]||(e[13]=[_("开始上传",-1)])),_:1,__:[13]})])]),default:i(()=>[r(se,{ref_key:"uploadRef",ref:Q,class:"upload-demo",drag:"",multiple:"","auto-upload":!1,"on-change":J,"on-remove":Y,"file-list":h.value},{tip:i(()=>e[10]||(e[10]=[o("div",{class:"el-upload__tip"}," 支持上传图片、文档、视频等文件，单个文件不超过 100MB ",-1)])),default:i(()=>[r(u,{class:"el-icon--upload"},{default:i(()=>[r(te)]),_:1}),e[11]||(e[11]=o("div",{class:"el-upload__text"},[_(" 拖拽文件到此处或 "),o("em",null,"点击选择文件")],-1))]),_:1,__:[11]},8,["file-list"])]),_:1},8,["modelValue"]),B.value.length>0?(a(),n("div",Ne,[(a(!0),n(C,null,D(B.value,s=>(a(),n("div",{key:s.id,class:"upload-item"},[r(u,{size:24,class:A(s.status==="success"?"upload-success":s.status==="error"?"upload-error":"")},{default:i(()=>[s.status==="uploading"||s.status==="waiting"?(a(),F(oe,{key:0})):s.status==="success"?(a(),F(ae,{key:1})):(a(),F(le,{key:2}))]),_:2},1032,["class"]),o("div",Ae,[o("div",Qe,d(s.file.name),1),s.status==="uploading"?(a(),F(ne,{key:0,percentage:s.progress,"stroke-width":4,"show-text":!1},null,8,["percentage"])):y("",!0),o("div",Ke,[s.status==="waiting"?(a(),n("span",Ge,"等待上传...")):s.status==="uploading"?(a(),n("span",He,"上传中: "+d(s.progress)+"%",1)):s.status==="success"?(a(),n("span",Je,"上传成功")):s.status==="error"?(a(),n("span",Ye,"上传失败: "+d(s.error),1)):y("",!0)])]),s.status==="error"?(a(),F(L,{key:0,type:"danger",text:"",onClick:f=>W(s)},{default:i(()=>e[14]||(e[14]=[_(" 重试 ",-1)])),_:2,__:[14]},1032,["onClick"])):y("",!0)]))),128))])):y("",!0)])}}},yt=he(qe,[["__scopeId","data-v-895a5091"]]);export{yt as default};
